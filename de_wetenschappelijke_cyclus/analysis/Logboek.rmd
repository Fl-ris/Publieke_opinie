---
title: "Logboek: Publieke Opinie"
author: "Floris Menninga"
date: "2024-04-22"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## **De enquete** ##

Om de meningen van het publiek te peilen met betrekking tot hun ethische normen en waarden is er een vragenlijst opgesteld 
die de volgende vragen en stellingen bevat:

<hr>
#### Persoonlijke vragen: ####

Wat is uw geslacht? 

Man, Vrouw, Anders, Zeg ik liever niet. 

Wat is uw leeftijd? (Jaar) 


Bent u gelovig? (Ja/nee) 

Zo ja welke geloof? 
	Christendom, Islam, Hindoeïsme, Boeddhisme, jodendom, anders: ___ 

Waar bent u geboren? (Land) 


In Nederland? --> welke provincie? 

		 
<hr>
#### Inhoudelijke vragen: #### 

1. Vindt u dat iemand zelf moet kunnen kiezen of die een abortus wil? 

1.5 Zo nee, zijn er situaties waarin dit wel het geval moet zijn? 

2. Moet een kind (onder 18) de keuze hebben om een abortus te krijgen? 

2.5 Moeten ouders zeggenschap hebben over of hun kind wel of niet abortus mogen plegen. 

https://fiom.nl/ongewenst-zwanger/abortus/wet-regelgeving-abortus  

 
3.  Is adoptie een alternatief voor abortus?                 

4. Moet de bedenktijd terugkomen? 

 5.. Vindt u dat er abortus gepleegd mag worden als de gezondheid van de vrouw door de zwangerschap in gevaar kan komen? 

6. Vindt u dat er abortus gepleegd mag worden als de zwangerschap een gevolg is van verkrachting? 

7. Moet het wettelijk verplicht voor vrouwen die een abortus willen om een echo van de foetus te zien voor een abortus toegestaan is? 

8. Moet de vader zeggenschap hebben over de beslissing om een abortus te induceren? 

 

Hoe goed kan u uzelf vinden in de volgende stellingen (op een schaal van 0 tot 10) 

Een abortus is wenselijk wanneer: 

    Het leven van de vrouw in gevaar is: (0 tot 10) 

    Het kind met een geestelijke handicap (zoals het syndroom van Down) geboren zou worden. (0 tot 10) 

    Het kind met een levensbedreigende ziekte geboren zou worden. (0 tot 10) 

    De zwangerschap veroorzaakt was door verkrachting. (0 tot 10) 

    De vrouw het kind niet wil hebben voor niet gespecificeerde redenen.  
    
Enkele vragen hiervan zijn afgeleid van het volgende document: https://news.gallup.com/poll/1576/abortion.aspx

De enquête is vervolgens in Microsoft Forms gemaakt met de bovenstaande vragen. 
 

## **Automatisch gegenereerde testdata** ##

Voordat de data van de enquete verzameld was hebben we testdata gemaakt met behulp van R.
Dit heeft als doel om te oefenen met de gebruikte statistische analyse methoden die ook gebruikt gaan worden voor echte data. 


<hr>


De data verwerken:
Huidige working directory: `r getwd()`

```{r }
abortus <- read.csv("abortus_dataset.csv",
                    na.strings = "NA")
head(abortus)
```

```{r}
summary(abortus)
#str(abortus)
```

```{r echo=FALSE}
library(ggplot2)

df <- data.frame(abortus$Wat.is.uw.leeftijd.) 

# verdeling van de leeftijden:
ggplot(df, aes(x= abortus$Wat.is.uw.leeftijd.)) +
  geom_density() +
  xlab("Leeftijd (Jaren)") 


```

## Omzetten naar factoren
In het onderstaande blok code worden factoren gemaakt van de meerkeuze vragen.


```{r}
library(ggplot2)
#table(abortus$Vindt.u.dat.iemand.zelf.moet.kunnen.kiezen.of.die.een.abortus.wil., useNA = "always")



# voor de vraag: Vindt u dat iemand zelf moet kunnen kiezen of die een abortus wil?
abortus$eigen_keuze_abortus <- factor(x = abortus$Vindt.u.dat.iemand.zelf.moet.kunnen.kiezen.of.die.een.abortus.wil.,  
                           levels = c("Ja", "Nee"),
                           labels = c("Wel abortus toestaan", "Geen abortus toestaan"))

# Voor de vraag: Wat is uw religieuze overtuiging?
abortus$geloof <- factor(x = abortus$Wat.is.uw.religieuze.overtuiging.., 
                           levels = c("Christendom", "Islam", "Hindoeïsme", "Boeddhisme", "Niet gelovig", "Anders"),
                           labels = c("Christendom", "Islam", "Hindoeïsme", "Boeddhisme", "Niet gelovig", "Anders"))


abortus$geslacht <- factor(x = abortus$Wat.is.uw.geslacht..,
                           levels = c("Man", "Vrouw"),
                           labels = c("Man", "Vrouw"))
# Voor de vraag: Wat is uw religieuze overtuiging?

abortus$afkomst <- factor(x = abortus$In.welke.provincie.heeft.u.het.grootste.deel.van.uw.jeugd.doorgebracht., 
                           levels = c("Drenthe", "Flevoland", "Friesland", "Gelderland", "Groningen", "Limburg", "Noord-Brabant", "Noord-Holland", "Overijssel", "Utrecht", "Zeeland", "Zuid-Holland", "Ik ben niet in Nederland opgegroeid"),
                           labels = c("Drenthe", "Flevoland", "Friesland", "Gelderland", "Groningen", "Limburg", "Noord-Brabant", "Noord-Holland", "Overijssel", "Utrecht", "Zeeland", "Zuid-Holland", "Buitenland"))



abortus.test <- data.frame(abortus$geloof)




table(abortus$eigen_keuze_abortus, useNA = "always") # voor de vraag: Vindt u dat iemand zelf moet kunnen kiezen of die een abortus wil?






#ggplot(df, aes(x=, y=abortus$Wat.is.uw.leeftijd.)) +
 # geom_bar(stat="identity", color="blue", fill="white")

```
```{r echo=TRUE}
library(ggplot2)
# Grafiek met de verschillende geloven en de leeftijdverdeling die er bij hoort. 
ggplot(df, aes(y=abortus$Wat.is.uw.religieuze.overtuiging..,
               x= abortus$Wat.is.uw.leeftijd.)) +
  geom_boxplot(color = "black", fill = "springgreen") +
    xlab("Leeftijd (Jaren") +
    ylab(" ") # namen van de geloven staan er al.... geen label nodig.

```



```{r}
library(ggplot2)



# Grafiek met leeftijden uit verschillende provincies.
ggplot(df, aes(y=abortus$In.welke.provincie.heeft.u.het.grootste.deel.van.uw.jeugd.doorgebracht.,
               x= abortus$Wat.is.uw.leeftijd.)) +
  geom_boxplot(color = "black", fill = "springgreen") +
    xlab("Leeftijd (Jaren") +
    ylab(" ") # namen van de geloven staan er al.... geen label nodig.



```



```{r}
library(ggplot2)

# De invultijd per leeftijd:

begin_tijd <- as.POSIXct(c(abortus$Begintijd)) # startpunt van invullen per persoon.
eind_tijd <- as.POSIXct(c(abortus$Tijd.van.voltooien)) # eindpunt  van invullen per persoon.

test <- c()
tijd_vector <- c()
# Om de totale tijd uit te rekenen die de mensen nodig hadden om het formulier in te vullen.
# Het verschil tussen de eindtijd en de begintijd. 
for (x in seq_along(abortus$Begintijd)) {
  #print(paste0("Begin tijd: ", begin_tijd[x]))
  #print(paste0("eind tijd: ", eind_tijd[x])) 
  tijd_vector[x] <- as.numeric((eind_tijd[x] - begin_tijd[x]))
}

```
Op 11 mei 2024 grafiek gemaakt van leeftijd / tijd nodig om de enquete in te vullen. 
12-05-2024: Met facet_wrap() onderscheid gemaakt tussen mannen en vrouwen. (twee plots)
```{r}
library(ggplot2)
tijd_vector <- data.frame(tijd_vector)
df3 <- data.frame(abortus$Wat.is.uw.leeftijd.) # test 

ggplot(tijd_vector, aes(y=tijd_vector,
                        x= abortus$Wat.is.uw.leeftijd.)) +
  geom_boxplot(aes(color = abortus$geslacht)) +
  facet_wrap(~abortus$geslacht) +
    xlab("Leeftijd (Jaren)") +
    ylab("Tijd om formulier in te vullen (minuten)") +
    coord_flip()

summary(tijd_vector)
head(tijd_vector)
```
# Circulair Packing test: 
```{r}
# Libraries
library(data.tree)
library(ggraph)
library(igraph)
library(tidyverse)
library(viridis)


# Load dataset from github
data <- read.table("https://raw.githubusercontent.com/holtzy/data_to_viz/master/Example_dataset/11_SevCatOneNumNestedOneObsPerGroup.csv", header=T, sep=";")
data[ which(data$value==-1),"value"] <- 1
colnames(data) <- c("Continent", "Region", "Country", "Pop")

# Remove a few problematic lines
data <- data %>% filter(Continent!="") %>% droplevels()

# Change the format. This use the data.tree library. This library needs a column that looks like root/group/subgroup/..., so I build it
library(data.tree)
data$pathString <- paste("world", data$Continent, data$Region, data$Country, sep = "/")
population <- as.Node(data)
data <- data.frame(
  root=rep("root", 15),
  group=c(rep("group A",5), rep("group B",5), rep("group C",5)), 
  subgroup= rep(letters[1:5], each=3),
  subsubgroup=rep(letters[1:3], 5),
  value=sample(seq(1:15), 15)
)


# root = hele populatie
# group = geslacht
# subgroup = profintie
# value = de waarde van het punt wat we willen visualizeren. 


# Change the format. This use the data.tree library. This library needs a column that looks like root/group/subgroup/..., so I build it

data$pathString <- paste("world", data$group, data$subgroup, data$subsubgroup, sep = "/")
population <- as.Node(data)
population



graph <- tbl_graph(flare$vertices, flare$edges)
set.seed(1)
ggraph(graph, 'circlepack', weight = size) + 
  geom_node_circle(aes(fill = depth), size = 0.25, n = 50) + 
  coord_fixed()
```
15-05-2024:
Om te achterhalen of de leeftijden van de mensen die de enquete ingevuld hebben normaal verdeeld zijn 
is de Shapiro Wilk test gebruikt. 
# Shapiro Wilk test:

```{r}
library("dplyr") 

shapiro.test(abortus$Wat.is.uw.leeftijd.)
             
```
De p-waarde is: 2.097e-05 
dat betekend dat er wel een significant verschil is tussen een nomale verdeling en deze leeftijd data. 

# Power analyse:

```{r}

pwr.t.test(n = n, d = d, sig.level = alpha, type = "one.sample", alternative = "less")

```
# PIE CHART
```{r}


# Load ggplot2
library(ggplot2)

# Create Data
data <- data.frame(
  group=abortus$afkomst,
  value=abortus$afkomst
)

# Basic piechart
ggplot(data, aes(x="", y=value, fill=group)) +
  geom_bar(stat="identity", width=1) +
  coord_polar("y", start=0)



```
```{r}


# Load ggplot2
library(ggplot2)
library(dplyr)

# Create Data
data <- data.frame(
  group=abortus$afkomst,
  value=abortus$afkomst
)




# Load ggplot2
library(ggplot2)
library(dplyr)

# Create Data
data <- data.frame(
  group=LETTERS[1:5],
  value=c(13,7,9,21,2)
)

# Compute the position of labels
data <- data %>% 
  arrange(desc(group)) %>%
  mutate(prop = value / sum(data$value) *100) %>%
  mutate(ypos = cumsum(prop)- 0.5*prop )

# Basic piechart
ggplot(data, aes(x="", y=prop, fill=group)) +
  geom_bar(stat="identity", width=1, color="white") +
  coord_polar("y", start=0) +
  theme_void() + 
  theme(legend.position="none") +
  
  geom_text(aes(y = ypos, label = group), color = "white", size=6) +
  scale_fill_brewer(palette="Set1")




```

## 

```{r}


y <- c(0,0,0,0,1,0,1,0,1,0,1,0,1,1)

p <- sum(y) / length(y)
# is p > PI (50%)

```


<hr>
