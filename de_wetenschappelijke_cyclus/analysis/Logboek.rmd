---
title: 'Logboek: Publieke Opinie'
author: "Floris Menninga"
date: "2024-04-22"
output:
  html_document: default
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r libraries, results='hold'}
# Libraries
library(data.tree)
library(ggraph)
library(igraph)
library(tidyverse)
library(viridis)
library(ggplot2)
library(dplyr) 
library(rgexf)

# Voor statistische analyses:
library("pwr")



```

## **Inleiding:** ##

Vragen over het abortus beleid zijn polariserende ethische kwesties. In ons onderzoek trachten we correlaties te vinden tussen verschillende variabelen zoals: leeftijd, geslacht, opleidingsniveau, geloof etc. en de ideologische verschillen in mening tussen deze mensen.  

Om de meningen van het publiek te peilen met betrekking tot hun ethische normen en waarden is er een vragenlijst opgesteld 
die de volgende vragen en stellingen bevat:

<hr>
#### Persoonlijke vragen: ####

Wat is uw geslacht? 

Man, Vrouw, Anders, Zeg ik liever niet. 

Wat is uw leeftijd? (Jaar) 


Bent u gelovig? (Ja/nee) 

Zo ja welke geloof? 
	Christendom, Islam, Hindoeïsme, Boeddhisme, jodendom, anders: ___ 

Waar bent u geboren? (Land) 


In Nederland? --> welke provincie? 

		 
<hr>
#### Inhoudelijke vragen: #### 

1. Vindt u dat iemand zelf moet kunnen kiezen of die een abortus wil? 

1.5 Zo nee, zijn er situaties waarin dit wel het geval moet zijn? 

2. Moet een kind (onder 18) de keuze hebben om een abortus te krijgen? 

2.5 Moeten ouders zeggenschap hebben over of hun kind wel of niet abortus mogen plegen. 

https://fiom.nl/ongewenst-zwanger/abortus/wet-regelgeving-abortus  

 
3.  Is adoptie een alternatief voor abortus?                 

4. Moet de bedenktijd terugkomen? 

 5.. Vindt u dat er abortus gepleegd mag worden als de gezondheid van de vrouw door de zwangerschap in gevaar kan komen? 

6. Vindt u dat er abortus gepleegd mag worden als de zwangerschap een gevolg is van verkrachting? 

7. Moet het wettelijk verplicht voor vrouwen die een abortus willen om een echo van de foetus te zien voor een abortus toegestaan is? 

8. Moet de vader zeggenschap hebben over de beslissing om een abortus te induceren? 

 

Hoe goed kan u uzelf vinden in de volgende stellingen (op een schaal van 0 tot 10) 

Een abortus is wenselijk wanneer: 

    Het leven van de vrouw in gevaar is: (0 tot 10) 

    Het kind met een geestelijke handicap (zoals het syndroom van Down) geboren zou worden. (0 tot 10) 

    Het kind met een levensbedreigende ziekte geboren zou worden. (0 tot 10) 

    De zwangerschap veroorzaakt was door verkrachting. (0 tot 10) 

    De vrouw het kind niet wil hebben voor niet gespecificeerde redenen.  
    
Enkele vragen hiervan zijn afgeleid van het volgende document: https://news.gallup.com/poll/1576/abortion.aspx

De enquête is vervolgens in Microsoft Forms gemaakt met de bovenstaande vragen. 
 

## **Automatisch gegenereerde testdata** ##

Voordat de data van de enquete verzameld was hebben we testdata gemaakt met behulp van R.
Dit heeft als doel om te oefenen met de gebruikte statistische analyse methoden die ook gebruikt gaan worden voor echte data. 


<hr>

## Verspreiden van de enquete ##
De makers van deze enquete hebben hem naar klasgenoten, familieleden en vrienden gestuurd met de instructie om hem door te sturen naar andere kenissen en vrienden. Op 21-05-2024 zijn er 110 mensen die hem ingevuld hebben met een man vrouw verdeling van: 60/49.

De data verwerken:
Huidige working directory: `r getwd()`

```{r }
abortus <- read.csv("abortus_dataset.csv",
                    na.strings = "NA")
head(abortus)
```

```{r}
summary(abortus)
#str(abortus)
```

```{r echo=T}

df_leeftijd <- data.frame(abortus$Wat.is.uw.leeftijd.) 

# verdeling van de leeftijden:
ggplot(df_leeftijd, aes(x= abortus$Wat.is.uw.leeftijd.)) +
  geom_density() +
  xlab("Leeftijd (Jaren)") 


```

## Omzetten naar factoren
In het onderstaande blok code worden factoren gemaakt van de meerkeuze vragen.


```{r}

#table(abortus$Vindt.u.dat.iemand.zelf.moet.kunnen.kiezen.of.die.een.abortus.wil., useNA = "always")



# voor de vraag: Vindt u dat iemand zelf moet kunnen kiezen of die een abortus wil?
abortus$eigen_keuze_abortus <- factor(x = abortus$Vindt.u.dat.iemand.zelf.moet.kunnen.kiezen.of.die.een.abortus.wil.,  
                           levels = c("Ja", "Nee"),
                           labels = c("Wel abortus toestaan", "Geen abortus toestaan"))

# Voor de vraag: Wat is uw religieuze overtuiging?
abortus$geloof <- factor(x = abortus$Wat.is.uw.religieuze.overtuiging.., 
                           levels = c("Christendom", "Islam", "Hindoeïsme", "Boeddhisme", "Niet gelovig", "Anders"),
                           labels = c("Christendom", "Islam", "Hindoeïsme", "Boeddhisme", "Niet gelovig", "Anders"))


abortus$geslacht <- factor(x = abortus$Wat.is.uw.geslacht..,
                           levels = c("Man", "Vrouw", "Wil ik liever niet melden"),
                           labels = c("Man", "Vrouw", "Wil ik liever niet melden"))
# Voor de vraag: Wat is uw religieuze overtuiging?

abortus$afkomst <- factor(x = abortus$In.welke.provincie.heeft.u.het.grootste.deel.van.uw.jeugd.doorgebracht., 
                           levels = c("Drenthe", "Flevoland", "Friesland", "Gelderland", "Groningen", "Limburg", "Noord-Brabant", "Noord-Holland", "Overijssel", "Utrecht", "Zeeland", "Zuid-Holland", "Ik ben niet in Nederland opgegroeid"),
                           labels = c("Drenthe", "Flevoland", "Friesland", "Gelderland", "Groningen", "Limburg", "Noord-Brabant", "Noord-Holland", "Overijssel", "Utrecht", "Zeeland", "Zuid-Holland", "Buitenland"))


abortus$onderwijsniveau <- factor(x =
                                abortus$Wat.is.het.hoogste.onderwijsniveau.dat.u.heeft.afgerond.,
                                  levels = c("Geen diploma", "Middelbare school", "MBO", "HBO", "Universiteit","Overige"),
                                  labels = c("Geen diploma", "Middelbare school", "MBO", "HBO", "Universiteit","Overige"))



# Voor de vraag: Indien u bij de vorige vraag nee heeft ingevuld...
abortus$als_nee <- factor(x = 
                        abortus$Indien.u.bij.de.vorige.vraag..Nee..heeft.ingevuld...Vindt.u.dat.er.uitzonderingen.zijn.waarin.iemand.dit.wel.zelf.moet.kunnen.kiezen.....,
                          levels = c("Ja", "Nee", "Niet van toepassing"),
                          labels = c("Ja", "Nee", "Niet van toepassing"))

abortus.test <- data.frame(abortus$geloof)

abortus$gezondheid_vrouw <- factor(x = abortus$Vindt.u.dat.er.voor.abortus.gekozen.mag.worden.als.de.gezondheid.van.de.vrouw.door.de.zwangerschap.in.gevaar.kan.komen.,
                                   levels = c("Ja", "Nee", "Weet ik niet"),
                                   labels = c("Ja", "Nee", "Weet ik niet"))


abortus$gevolg <- factor(x = abortus$De.zwangerschap.veroorzaakt.is.door.verkrachting,
                         levels = c("Ja", "Nee"),
                         labels = c("Ja", "Nee"))

abortus$minderjarig <- factor(x = abortus$Vindt.u.dat.een.minderjarig.kind.de.keuze.moet.hebben.om.voor.een.abortus.te.kiezen.....,
                              levels = c("Ja", "Nee", "Weet ik niet"),
                              labels = c("Ja", "Nee", "Weet ik niet"))

abortus$ouders <- factor(x = abortus$Vindt.u.dat.de.ouders.zeggenschap.moeten.hebben.over.of.hun.minderjarige.kind.wel.of.niet.voor.abortus.mag.kiezen...,
                         levels = c("Ja", "Nee", "Weet ik niet"),
                         labels = c("Ja", "Nee", "Weet ik niet"))

abortus$echo <- factor(x = abortus$Moet.het.wettelijk.verplicht.worden.voor.vrouwen.die.een.abortus.willen.om.een.echo.van.de.foetus.te.zien.voordat.een.abortus.toegestaan.is.,
                       levels = c("Ja", "Nee", "Weet ik niet"),
                       labels = c("Ja", "Nee", "Weet ik niet"))

abortus$bedenktijd <- factor(x = abortus$Vindt.u.dat.de.wettelijke.bedenktijd.moet.terugkomen.,
                             levels = c("Ja", "Nee", "Weet ik niet"),
                             labels = c("Ja", "Nee", "Weet ik niet"))
                             
abortus$adoptie <- factor(x = abortus$Vindt.u.dat.adoptie.een.alternatief.is.voor.abortus.,
                          levels = c("Ja", "Nee", "Weet ik niet"),
                          labels = c("Ja", "Nee", "Weet ik niet"))

abortus$vader <- factor(x = 
                          abortus$Moet.de.biologische.vader.zeggenschap.hebben.over.de.beslissing.voor.een.abortus.,
                            levels = c("Ja", "Nee"),
                            labels = c("Ja", "Nee"))

# Vragen met een volgorde: 
# namen van de variabelen eidigen met "_o" om aan te duiden dat er een volgorde in zit (order)

abortus$levensgevaar_vrouw_o <- factor(x = abortus$Het.leven.van.de.vrouw.in.gevaar.is,
                                     levels = c("zeer oneens", "oneens", "beetje oneens", "neutraal", "beetje eens", "eens", "zeer eens"),
                                     labels = c("zeer oneens", "oneens", "beetje oneens", "neutraal", "beetje eens", "eens", "zeer eens"),
                                     order = TRUE)

abortus$geestelijke_handicap_o <- factor(x = abortus$Het.kind.met.een.geestelijke.handicap.geboren.kan.worden,
                                         levels = c("zeer oneens", "oneens", "beetje oneens", "neutraal", "beetje eens", "eens", "zeer eens"),
                                         labels = c("zeer oneens", "oneens", "beetje oneens", "neutraal", "beetje eens", "eens", "zeer eens"),
                                         order = TRUE)
abortus$levensbedreigende_ziekte_o <- factor(x = abortus$Het.kind.met.een.levensbedreigende.ziekte.geboren.kan.worden,
                                             levels = c("zeer oneens", "oneens", "beetje oneens", "neutraal", "beetje eens", "eens", "zeer eens"),
                                             labels = c("zeer oneens", "oneens", "beetje oneens", "neutraal", "beetje eens", "eens", "zeer eens"),
                                             order = TRUE)

abortus$veroorzaakt_o <- factor(x = abortus$De.zwangerschap.veroorzaakt.is.door.verkrachting,
                                levels = c("zeer oneens", "oneens", "beetje oneens", "neutraal", "beetje eens", "eens", "zeer eens"),
                                labels = c("zeer oneens", "oneens", "beetje oneens", "neutraal", "beetje eens", "eens", "zeer eens"),
                                order = TRUE)

abortus$niet_gespecificeerd_o <- factor(x = abortus$De.vrouw.het.kind.niet.wil.houden.om.niet.gespecificeerde.redenen,
                                        levels = c("zeer oneens", "oneens", "beetje oneens", "neutraal", "beetje eens", "eens", "zeer eens"),
                                        labels = c("zeer oneens", "oneens", "beetje oneens", "neutraal", "beetje eens", "eens", "zeer eens"),
                                        order = TRUE)


abortus$financiele_beperkingen <- factor(x = abortus$De.vrouw.niet.in.staat.is.voor.het.kind.te.zorgen.vanwege.financiële.beperkingen,
                                         levels = c("zeer oneens", "oneens", "beetje oneens", "neutraal", "beetje eens", "eens", "zeer eens"),
                                         labels = c("zeer oneens", "oneens", "beetje oneens", "neutraal", "beetje eens", "eens", "zeer eens"),
                                         order =TRUE)






df <- data.frame(abortus)

#ggplot(df, aes(x=, y=abortus$Wat.is.uw.leeftijd.)) +
 # geom_bar(stat="identity", color="blue", fill="white")

```

### Overzicht: abortus toestaan of niet:
```{r}
table(abortus$eigen_keuze_abortus, useNA = "always") # voor de vraag: Vindt u dat iemand zelf moet kunnen kiezen of die een abortus wil?

```


```{r echo=TRUE}

# Grafiek met de verschillende geloven en de leeftijdverdeling die er bij hoort. 
ggplot(df, aes(y=abortus$geloof,
               x= abortus$Wat.is.uw.leeftijd.)) +
  geom_boxplot(color = "black", fill = "gold", varwidth=T) +
    xlab("Leeftijd (Jaren") +
    ylab("Geloof")

```
Verdeling van de leeftijd van de mensen die de enquete hebben ingevuld en hun ideologie. 


```{r}

# Grafiek met leeftijden uit verschillende provincies.
ggplot(df, aes(y=abortus$afkomst,
               x= abortus$Wat.is.uw.leeftijd.)) +
  geom_boxplot(color = "black", fill = "gold") +
    xlab("Leeftijd (Jaren") +
    ylab("Op gegroeid in de provincie:")



```
De verdeling van de leeftijden en de provincies waar deze mensen vandaan komen wordt weergegeven op deze grafiek. 
Niet elke provincie heeft genoeg datapunten om een boxplot van te maken. 


```{r}

# De invultijd per leeftijd:

# Repareren: as.POSIXct functie werkt niet meer voor deze data.

begin_tijd <- as.POSIXct(x = (c(abortus$Begintijd)), format = "%m-%d-%y %H:%M:%S")  # startpunt van invullen per persoon, as.POSIXct met format om de datum en tijd op de juiste manier door te geven. 

# 
eind_tijd <- as.POSIXct(x = (c(abortus$Tijd.van.voltooien)), format = "%m-%d-%y %H:%M:%S") # eindpunt  van invullen per persoon.

tijd_vector <- c()
# Om de totale tijd uit te rekenen die de mensen nodig hadden om het formulier in te vullen.
# Het verschil tussen de eindtijd en de begintijd. 
for (x in seq_along(abortus$Begintijd)) { # Loop door de begintijden heen..
  #print(paste0("Begin tijd: ", begin_tijd[x]))
  #print(paste0("eind tijd: ", eind_tijd[x])) 
  tijd_vector[x] <- as.numeric((eind_tijd[x] - begin_tijd[x])) # Voeg toe aan tijdsvector: het verschil tussen eind_tijd en begin_tijd om totale invul tijd te krijgen.
}

```


Op 11 mei 2024 grafiek gemaakt van leeftijd / tijd nodig om de enquete in te vullen. 
12-05-2024: Met facet_wrap() onderscheid gemaakt tussen mannen en vrouwen. (twee plots)


```{r}

tijd_vector <- data.frame(tijd_vector)

ggplot(tijd_vector, aes(y=tijd_vector,
                        x= abortus$Wat.is.uw.leeftijd.)) +
  geom_boxplot(aes(color = abortus$geslacht)) +
  facet_wrap(~abortus$geslacht) +
    xlab("Leeftijd (Jaren)") +
    ylab("Tijd om formulier in te vullen (minuten)") #+
    #coord_flip()

#summary(tijd_vector)
#head(tijd_vector)


```
Bovenstaande grafiek laat de relatie tussen leeftijd en tijdnodig om het formulier in te vullen zien. 
Dit wordt voor mannen en vrouwen gedaan. (links mannen, midden vrouwen en rechts ongespecificeerd.)
Er was maar een persoon dat ongespecificeerd opgav dus kan daar geen boxplot van gemaakt worden maar wordt dit weergeven met een enkele stip. (links onder in de grafiek)

```{r}

data_frame_invultijd <- data.frame(tijd_vector, abortus$geslacht, abortus$Wat.is.uw.leeftijd.)

# Voor de tijd die de mannen er over doen:
invultijd_mannen <- data_frame_invultijd %>%
  filter(abortus.geslacht == "Man")

# Voor de tijd die de vrouwen er over doen:
invultijd_vrouwen <- data_frame_invultijd %>%
  filter(abortus.geslacht == "Vrouw")

# Voor de tijd die de "ongespecificeerde geslacht" mensen er over doen:
invultijd_anders <- data_frame_invultijd %>%
  filter(abortus.geslacht == "Wil ik liever niet melden")



```

Gemiddeld doen de mannen er `r mean(invultijd_mannen$tijd_vector)` minuten over om de enquete in te vullen. <br>
Dit ligt tussen de `r quantile(invultijd_mannen$tijd_vector, 0.25)` (25%) en `r quantile(invultijd_mannen$tijd_vector, 0.75)` (75%)

Gemiddeld doen de vrouwen er `r mean(invultijd_vrouwen$tijd_vector)` minuten over om de enquete in te vullen. <br>
Dit ligt tussen de `r quantile(invultijd_vrouwen$tijd_vector, 0.25)` (25%) en `r quantile(invultijd_vrouwen$tijd_vector, 0.75)` (75%)

Gemiddeld doen de "Geslacht niet opgegeven mensen" er `r mean(invultijd_anders$tijd_vector)` minuten over om de enquete in te vullen. <br>
Dit ligt tussen de `r quantile(invultijd_anders$tijd_vector, 0.25)` (25%) en `r quantile(invultijd_anders$tijd_vector, 0.75)` (75%)


# Circulair Packing test 1: 
Test met data van het internet om het hierachrische data format beter te begrijpen.
```{r eval=FALSE}



# Load dataset from github
data <- read.table("https://raw.githubusercontent.com/holtzy/data_to_viz/master/Example_dataset/11_SevCatOneNumNestedOneObsPerGroup.csv", header=T, sep=";")
data[ which(data$value==-1),"value"] <- 1
colnames(data) <- c("Continent", "Region", "Country", "Pop")

# Remove a few problematic lines
data <- data %>% filter(Continent!="") %>% droplevels()

# Change the format. This use the data.tree library. This library needs a column that looks like root/group/subgroup/..., so I build it
library(data.tree)
data$pathString <- paste("world", data$Continent, data$Region, data$Country, sep = "/")
population <- as.Node(data)
data <- data.frame(
  root=rep("root", 15),
  group=c(rep("group A",5), rep("group B",5), rep("group C",5)), 
  subgroup= rep(letters[1:5], each=3),
  subsubgroup=rep(letters[1:3], 5),
  value=sample(seq(1:15), 15)
)


# root = hele populatie
# group = geslacht
# subgroup = profintie
# value = de waarde van het punt wat we willen visualizeren. 


# Change the format. This use the data.tree library. This library needs a column that looks like root/group/subgroup/..., so I build it

data$pathString <- paste("world", data$group, data$subgroup, data$subsubgroup, sep = "/")
population <- as.Node(data)
population



#graph <- tbl_graph(flare$vertices, flare$edges)
set.seed(1)
ggraph(graph, 'circlepack', weight = size) + 
  geom_node_circle(aes(fill = depth), size = 0.25, n = 50) + 
  coord_fixed()

```
15-05-2024:
Om te achterhalen of de leeftijden van de mensen die de enquete ingevuld hebben normaal verdeeld zijn 
is de Shapiro Wilk test gebruikt. 

### Shapiro Wilk test:
Deze test wordt uitgevoerd om vast te stellen of leeftijden van de mensen die de enquete ingevuld hebben normaal verdeeld is.
```{r}


shapiro_test <- shapiro.test(abortus$Wat.is.uw.leeftijd.)
shapiro_test

```
De p-waarde is: 2.097e-05 (`r shapiro_test$p.value`)
dat betekend dat er wel een significant verschil is tussen een nomale verdeling en deze leeftijd data. 
Omdat de data niet normaal verdeeld is zal een niet-parametrische analyse nodig zijn. 
Voorbeelden van deze non parametrische zijn: de Kruskal-Wallis test en de Chi-square en de two way z test.

# Power analyse: <br>

```{r}

#pwr.t.test(n = n, d = d, sig.level = alpha, type = "one.sample", alternative = "less")

```
### Pie chart: <br>
 Niet gebruiken, alleen om te proberen...
```{r}

# Create Data
data <- data.frame(
  group=abortus$afkomst,
  value=abortus$afkomst
)

# Basic piechart
ggplot(data, aes(x="", y=value, fill=group)) +
  geom_bar(stat="identity", width=1) +
  coord_polar("y", start=0)



```
```{r}
# Test pie chart:
#library(ggplot2)
# Create Data
data <- data.frame(
  group=abortus$afkomst,
  value=abortus$afkomst
)


# Basic piechart
ggplot(data, aes(x="", y=abortus$afkomst, fill=group)) +
  geom_bar(stat="identity", width=1, color="white") +
  coord_polar("y", start=0) +
  theme_void() + 
  theme(legend.position="none") 




```
```{r eval=T}
df_1 <- data.frame(abortus)

ggplot(df_1, aes(x= c(1:109), y = vader)) +
  geom_point(aes(color = geslacht)) +
  labs(color = "test") +
  #scale_color_manual(name = "Cylinders") 
#  scale_fill_discrete(name = "test") +
  ggtitle("Moet de vader zeggenschap hebben over \nde beslissing om een abortus te induceren? ") 

  

```

```{r}


ggplot(df, aes(x= ID, y = onderwijsniveau)) +
  geom_jitter(aes(color = vader, shape = geslacht), width = 0.005, alpha = 0.7) +
  labs(color = "Keuze") +
  #geom_jitter(width = 0.005, alpha = 0.7)
  ggtitle("Moet de vader zeggenschap hebben over \nde beslissing om een abortus te induceren? ")


```


15-05-2024:
Bovenstaande grafiek: Moet de vader zeggenschap hebben over de abortus: Ja, Nee of geen mening.
Het geslacht van het persoon wordt met de twee kleuren blauw en rood aangegeven en de leeftijd met de grootte van het bolletje. (zie legenda voor schaalverdeling)

20-05-2024:

```{r}
# Voor vraag: Als u geen voorstander bent voor de vrijheid om voor een abortus te kiezen, zijn er gevallen waarin dit wel zou mogen?

ggplot(data = df, mapping = aes(x = (ID), y = als_nee)) +
  geom_bar(stat = "identity") +
  geom_point()

```
```{r}
# Voor de vraag: Vindt u dat er voor abortusgekozen mag worden als de gezondheid van de vrouw door de zwangerschap in gevaar kan komen? 
library(ggridges)
ggplot(data = df, mapping = aes(x = c(1:109), y = levensgevaar_vrouw_o, fill = geslacht)) +
  geom_bar(stat = "identity") +
  geom_text(aes(label = (" "))) +
  ggtitle("Vindt u dat er voor abortusgekozen mag worden als de gezondheid van \nde vrouw door de zwangerschap in gevaar kan komen?") +
  xlab("Percentage mensen") + # nog aapassen naar procent.
  ylab(" ") # Geen ylabel nodig omdat er al een beschrijving bij de waardes staan. 
  # labels beter maken.
  # To-do: prercentage verbeteren, huidige waarden kloppen nog niet.
```
```{r}
# Voor de vraag: Mag abortus toegestaan zijn als de zwangerschap resultaat is van verkrachting?

ggplot(data = df, mapping = aes(x = (ID/100), y = veroorzaakt_o, fill = geslacht)) + # geeft procent weer. 
  geom_bar(stat = "identity") +
  ggtitle("Mag abortus als de zwangerschap\nresultaat is van verkrachting?") +
  xlab("Percentage mensen") + # verifiëren of dit wel klopt...
  ylab(" ")
```

```{r}
#Voor de vraag:  
#ggplot(data = df, mapping = aes(x = ))


ggplot(data = df, mapping = aes(x = (c(1:109)), y = levensgevaar_vrouw_o)) + # geeft procent weer. 
  geom_bar(stat = "identity", aes(fill = Wat.is.uw.leeftijd.)) +
  facet_wrap(~geslacht) +
  ggtitle("Mag abortus als het leven van de vrouw in gevaar komt tijdens\nde zwangerschap?") +
  xlab("Percentage mensen") + # verifiëren of dit wel klopt...
  ylab(" ")

  # To-do: sorteer voorl leeftijd gradient.
```


## Cirkel packing grafiek test

```{r eval=F}
# Test 2:


edges <- data.frame(c("test", "test.test2", "test.test2.test3", "test0"))
vertices <- data.frame(c("1", "2", "3"), c("1", "2", "3"))

 
edgelist <- matrix(list(c("1","2","3"), c("1","2","3")),
                    byrow=TRUE, ncol=2)

edge.list(edgelist)

# We need a data frame giving a hierarchical structure. Let's consider the flare dataset:
#edges <- flare$edges
# Usually we associate another dataset that give information about each node of the dataset:
#vertices <- flare$vertices

# Then we have to make a 'graph' object using the igraph library:
mygraph <- graph_from_data_frame(edgelist)


library(data.tree)
df9 <- data.frame(name = c("land", "water", "air", "car", "bicycle", "boat", "balloon", "airplane", "helicopter", "Ford", "BMW", "Airbus"), 
                 parent = c("root", "root", "root", "land", "land", "water", "air", "air", "air", "car", "car", "airplane"))
tree <- FromDataFrameNetwork(df9)

vv <- ToDataFrameTree(tree, 
                level1 = function(x) x$path[2],
                level2 = function(x) x$path[3],
                level3 = function(x) x$path[4],
                level_number = function(x) x$level - 1)[-1,-1]

# Test
hc <- df %>%
  dist %>%
  hclust
cc <- tree(c(1:5))
plot(hc)


# Make the plot
ggraph(cc, layout = 'circlepack') + 
  geom_node_circle() +
  theme_test()
```

```{r}
library(ggraph)
library(igraph)
library(tidyverse)
 
# We need a data frame giving a hierarchical structure. Let's consider the flare dataset:
edges <- flare$edges
#edges <- 
 
# Usually we associate another dataset that give information about each node of the dataset:
vertices <- flare$vertices
 
# Then we have to make a 'graph' object using the igraph library:
mygraph <- graph_from_data_frame( edges, vertices=vertices )
 
# Make the plot
ggraph(mygraph, layout = 'circlepack') + 
  geom_node_circle() +
  theme_void()
```

# Power test: (met leeftijd van de mensen)

17-05-2024:
Begin gemaakt met t.test en power test

```{r}
library(dplyr)
library(pwr)
tabel <- table(abortus$geslacht ,abortus$eigen_keuze_abortus) # tabel met mannen en vrouwen en hun keuze of abortus toegestaan moet worden of niet. 

#prop.table(abortus$Wat.is.uw.geslacht..)
tabel2 <- prop.table(tabel)

#gem_leeftijd_vrouwen %>%
# filter(abortus$Wat.is.uw.geslacht.., abortus$geslacht == "Vrouw")



ja_abortus <- (ifelse(abortus$eigen_keuze_abortus=="Wel abortus toestaan", 1,0)) # 1 voor de mensen de voorstander zijn, 0 als ze tegen zijn. 


#(res <- t.test(ja_abortus, mu = 52 , alternative = "two.sided") )

# Reken de proportie mannen uit die voorstanders van abortus zijn:
man_ja_abortus <- df %>% 
  filter(geslacht == "Man")
prop_man_ja_abortus <- prop.table(table(ifelse(df$eigen_keuze_abortus=="Wel abortus toestaan", 1,0)))



# Bereken het zelfde voor de vrouwen:
vrouw_ja_abortus <- df %>% 
  filter(geslacht == "Vrouw")
prop_vrouw_ja_abortus <- prop.table(table(ifelse(df$eigen_keuze_abortus=="Wel abortus toestaan", 1,0)))



# effect sterkte h uitrekenen met de twee ja/nee proporties (tussen mannen en vrouwen)
h <- ES.h(prop_man_ja_abortus[2], prop_man_ja_abortus[1]) # Er werkt iets niet goed...


power1 <- pwr.t.test(sig.level = 0.05, power = 0.8, n = 109 ,alternative = "two.sided") # test, andere h uitrekenen.
power2 <- pwr.t.test(d = 0.5,sig.level = 0.05, power = 0.8, alternative = "two.sided") # test, andere h uitrekenen.


```
Om met een effect sterkte van 0.5 het verschil tussen de twee geslachten aan te tonen zijn er `r round(power2$n, digits = 0)` mensen nodig (van elke groep).
En met de 109 mensen die we nu hebben is de effect sterkte: `r round(power1$d, digits = 2)`. Dit is genoeg om een middelgroot verschil waar te nemen. 



# Chi-square: <br>
En chi-square test voor alle enquete vragen en de invloed die het geslacht op de keuzes heeft. 
**Vraag:** Vindt u dat iemand zelf moet kunnen kiezen of die een abortus wil? <br>
>H0: Het geslacht van het persoon dat de enquete invult heeft geen invloed op hun keuze over het toestaan van de abortus.
>H1: Het geslacht van het persoon dat de enquete invult heeft invloed op hun keuze over het toestaan van de abortus.

**23-05-2024:**
De H0 en H1 hypotheses worden hier opgesteld voor alle vragen:

**Vraag:** Vindt u dat er voor abortus gekozen mag worden als de gezondheid van de vrouw door de zwangerschap in gevaar kan komen? <br>
>H0: Het geslacht van het persoon dat de enquete invult heeft geen invloed op hun keuze of een vrouw een abortus mag hebben wanneer haar leven in gevaar is. 
>H1: Het geslacht van het persoon dat de enquete invult heeft invloed op hun keuze of een vrouw een abortus mag hebben wanneer haar leven in gevaar is. 

**Vraag:** Vindt u dat iemand een abortus mag als de zwangerschap een gevolg is van verkrachting? <br>
>H0: Het geslacht van het persoon dat de enquete invult heeft geen invloed op hun keuze over het toestaan van een abortus wanneer de zwangerschap gevolg is van verkrachting.
>H1: Het geslacht van het persoon dat de enquete invult heeft invloed op hun keuze over het toestaan van een abortus wanneer de zwangerschap gevolg is van verkrachting.

**Vraag:** Vindt u dat een minderjarig kind de keuze moet hebben om voor een abortus te kiezen? <br>
>H0: Het geslacht van het persoon dat de enquete invult heeft geen invloed op hun keuze of een minderjarig kind de keuze moet hebben om voor een abortus te kiezen. 
>H1: Het geslacht van het persoon dat de enquete invult heeft invloed op hun keuze of een minderjarig kind de keuze moet hebben om voor een abortus te kiezen.

**Vraag:** Vindt u dat de ouders zeggenschap moeten hebben over of hun minderjarige kind wel of niet voor abortus mag kiezen? <br>
>H0: Het geslacht van het persoon dat de enquete invult heeft geen invloed op hun keuze of de ouders van een minderjarig kind zeggenschap moeten hebben over of hun minderjarige kind wel of niet voor abortus mag kiezen? <br>
>H1: Het geslacht van het persoon dat de enquete invult heeft invloed op hun keuze of de ouders van een minderjarig kind zeggenschap moeten hebben over of hun minderjarige kind wel of niet voor abortus mag kiezen?

**Vraag:** Moet het wettelijk verplicht worden voor vrouwen die een abortus willen om een echo van de foetus te zien voordat een abortus toegestaan is? <br>
>H0: Het geslacht van het persoon dat de enquete invult heeft geen invloed op hun keuze of ze vinden dat het wettelijk verplicht worden voor vrouwen die een abortus willen om een echo van de foetus te zien voordat een abortus toegestaan is. <br>
>H1: Het geslacht van het persoon dat de enquete invult heeft invloed op hun keuze of ze vinden dat het wettelijk verplicht worden voor vrouwen die een abortus willen om een echo van de foetus te zien voordat een abortus toegestaan is. <br >

**Vraag:** Vindt u dat de wettelijke bedenktijd moet terugkomen? <br>
>H0:  Het geslacht van het persoon dat de enquete invult heeft geen invloed op hun keuze of de wettenlijke bedenktijd terug moet komen. 
>H1: Het geslacht van het persoon dat de enquete invult heeft invloed op hun keuze of de wettenlijke bedenktijd terug moet komen.

**Vraag:** Vindt u dat adoptie een alternatief is voor abortus? <br>
>H0: Het geslacht van het persoon dat de enquete invult heeft geen invloed op hun keuze of adoptie een alternatief is voor abortus. 
>H1: Het geslacht van het persoon dat de enquete invult heeft invloed op hun keuze of adoptie een alternatief is voor abortus.

**Vraag:** Moet de biologische vader zeggenschap hebben over de beslissing voor een abortus?
>H0: Het geslacht van het persoon dat de enquete invult heeft geen invloed op hun keuze of de biologische vader zeggenschap moet hebben over de beslissing voor een abortus.
>H1: Het geslacht van het persoon dat de enquete invult heeft invloed op hun keuze of de biologische vader zeggenschap moet hebben over de beslissing voor een abortus.

```{r}
#onder21 <- filter(abortus$Wat.is.uw.leeftijd., abortus$Wat.is.uw.leeftijd. < 21)

#binaire_lijst_keuze_abortus <- 

ja_abortus <- (ifelse(abortus$eigen_keuze_abortus=="Wel abortus toestaan", 1,0)) # 1 voor de mensen de voorstander zijn, 0 als ze tegen zijn.
chi_ja_abortus <- chisq.test(df$geslacht, ja_abortus, correct = T)

ja_abortus_onder_21_df <-  df %>% 
  filter(df$Wat.is.uw.leeftijd. <= 21)
ja_abortus_onder_21 <- (ifelse(ja_abortus_onder_21_df$eigen_keuze_abortus=="Wel abortus toestaan", 1,0))
#all(duplicated(abortus$geslacht)[-1L])

ja_nee_abortus_onder_21 <- chisq.test(df$geslacht, ja_abortus, correct = T)



#ja_nee_abortus <- t.test(ja_abortus, as.numeric(abortus$geslacht), data = abortus, alternative = "two.sided")


# Resultaat kan bijna niet kloppen.... achterhaal wat er mis is.
```

H0 is verworpen en H1 is aangenomen omdat de p-waarde `"r" ja_nee_abortus$p.value` is. Dit is onder de 0.05 en betekend dat met 95% zekerheid gezegd kan worden dat het geen toeval is dat er een verschil tussen de twee geslachten is en hun keuze om de abortus toe te staan of te verbieden. 



```{r}
# Chi-square voor de vraag: Vindt u dat iemand een abortus mag als de zwangerschap een gevolg is van verkrachting?

# Lijst van 1 en 0 maken voor Ja en Nee. 
abortus_als_gevolg_van_01 <- (ifelse(abortus$Vindt.u.dat.iemand.een.abortus.mag.als.de.zwangerschap.een.gevolg.is.van.verkrachting.=="Ja", 1,0)) # 1 voor de mensen de voorstander zijn, 0 als ze tegen zijn.

# Chi-square test:
chi_abortus_als_gevolg_van <- chisq.test(df$geslacht, abortus_als_gevolg_van_01, correct = T)

```

```{r}
# Chi-square voor de vraag: Vindt u dat een minderjarig kind de keuze moet hebben om voor een abortus te kiezen?

# Lijst van 1 en 0 maken voor Ja en Nee. 
abortus_minderjarig_keuze_01 <- (ifelse(abortus$minderjarig=="Ja", 1,0)) # 1 voor de mensen de voorstander zijn, 0 als ze tegen zijn.

# Chi-square test:
chi_abortus_minderjarig_keuze <- chisq.test(df$geslacht, abortus_minderjarig_keuze_01, correct = T)

```
```{r}
# Chi-square voor de vraag: Vindt u dat de ouders zeggenschap moeten hebben over of hun minderjarige kind wel of niet voor abortus mag kiezen?

# Lijst van 1 en 0 maken voor Ja en Nee. 
abortus_zeggenschap_ouders_01 <- (ifelse(abortus$ouders=="Ja", 1,0)) # 1 voor de mensen de voorstander zijn, 0 als ze tegen zijn.

# Chi-square test:
chi_abortus_zeggenschap_ouders <- chisq.test(df$geslacht, abortus_zeggenschap_ouders_01, correct = T)

# Test om leeftijd mee te nemen als factor:
#chi_abortus_als_gevolg_van_leeftijd <- chisq.test(df$Wat.is.uw.leeftijd., abortus_zeggenschap_ouders, correct = T)

```

```{r}
# Chi-square voor de vraag: Moet het wettelijk verplicht worden voor vrouwen die een abortus willen om een echo van de foetus te zien voordat een abortus toegestaan is?

# Lijst van 1 en 0 maken voor Ja en Nee. 
abortus_echo_01 <- (ifelse(abortus$minderjarig=="Ja", 1,0)) # 1 voor de mensen de voorstander zijn, 0 als ze tegen zijn.

# Chi-square test:
chi_abortus_echo <- chisq.test(df$geslacht, abortus_echo_01, correct = T)

```

```{r}
# Chi-square voor de vraag: Vindt u dat de wettelijke bedenktijd moet terugkomen?

# Lijst van 1 en 0 maken voor Ja en Nee. 
abortus_bedenktijd_01 <- (ifelse(abortus$bedenktijd=="Ja", 1,0)) # 1 voor de mensen de voorstander zijn, 0 als ze tegen zijn.

# Chi-square test:
chi_abortus_bedenktijd <- chisq.test(df$geslacht, abortus_bedenktijd_01, correct = T)

```

```{r}
# Chi-square voor de vraag: Vindt u dat adoptie een alternatief is voor abortus?

# Lijst van 1 en 0 maken voor Ja en Nee. 
abortus_adoptie_01 <- (ifelse(abortus$adoptie=="Ja", 1,0)) # 1 voor de mensen de voorstander zijn, 0 als ze tegen zijn. 

# Chi-square test:
chi_abortus_adoptie <- chisq.test(df$geslacht, abortus_adoptie_01, correct = T)

```

```{r}
# Chi-square voor de vraag: Moet de biologische vader zeggenschap hebben over de beslissing voor een abortus?

# Lijst van 1 en 0 maken voor Ja en Nee. 
abortus_zeggenschap_vader_01 <- (ifelse(abortus$vader=="Ja", 1,0)) # 1 voor de mensen de voorstander zijn, 0 als ze tegen zijn. 

# Chi-square test:
chi_abortus_zeggenschap_vader <- chisq.test(df$geslacht, abortus_zeggenschap_vader_01, correct = T)

```
## Visualisatie van de Chi-square resultaten:

```{r}
chi_test_vector_geslacht <- c(chi_ja_abortus,chi_abortus_als_gevolg_van,chi_abortus_minderjarig_keuze,chi_abortus_zeggenschap_ouders,chi_abortus_echo,chi_abortus_bedenktijd,chi_abortus_adoptie,chi_abortus_zeggenschap_vader)

labels_chi_test_vector_geslacht <- c(1:8)

df_chi_geslacht <- data.frame(chi_ja_abortus[3],chi_abortus_als_gevolg_van[3],chi_abortus_minderjarig_keuze[3],chi_abortus_zeggenschap_ouders[3],chi_abortus_echo[3],chi_abortus_bedenktijd[3],chi_abortus_adoptie[3],chi_abortus_zeggenschap_vader[3]) %>% rename(
  chi_ja_abortus = p.value,
  chi_abortus_als_gevolg_van = p.value.1,
  chi_abortus_minderjarig_keuze = p.value.2,
  
  
  
  
  
  
)


```

```{r}
ggplot(data = )

```


# Two-way chi^2 test:
De volgende hypothese is opgesteld:
H0: Geslacht is geen bijdragende factor in de keuze of abortus toegestaan mag zijn of niet. 
H1: Geslacht is een bijdragende factor in de keuze of abortus toegestaan mag zijn of niet.

```{r}
# Test om te kijken hoe het werkt:
#test_ja_abortus <- df %>% filter(geslacht == "Man")


#test_ja_abortus <- (ifelse(test_ja_abortus$eigen_keuze_abortus=="Wel abortus toestaan" & #test_ja_abortus$geslacht == "Man", 6,0))
#chisq.test(df$geslacht, ja_abortus ,correct = F)

# Chi-square test:
chi_ja_abortus <- chisq.test(df$geslacht, ja_abortus, correct = F)

```
De p-waarde van de Chi-square test is: `r chi_ja_abortus$p.value` dit is boven de 0.05 dus kan de nul hypothese aangenomen worden, geslacht is geen bijdragende factor in de keuze of abortus toegestaan mag zijn of niet. <br>
De Chi-squered waarde is: `r round(chi_ja_abortus$statistic, digits = 2)` <br>

<hr>


### To-do: voor grafieken proporties gebruiken i.p.v. absolute aantallen (om rekening te houden met verschillen en aantal "metingen" tussen mannen en vrouwen.) ###

21-05-2024:
** Two-way Z-test:**
Voor het beantwoorden van de vraag: Heeft het geslacht invloed op de keuze.... (afhankelijk van de vraag, herhalen voor alle vragen) 
```{r}
library("BSDA")
#df_z_test <- 
#z_test_abortus <- z.test(df$geslacht, ja_abortus, sigma.x = sd(df$geslacht))
```

To-do:


### Grafiek leeftijd/keuze:
Op de onderstaande grafiek wordt het verband tussen leeftijd en keuze bij de vraag: wel of niet abortus toestaan weergeven.

```{r}

ggplot(data = df, mapping = aes(x = Wat.is.uw.leeftijd., y = c(1:109))) +
  geom_point(aes(color = eigen_keuze_abortus, size = Wat.is.uw.leeftijd.)) +
  facet_wrap(~geslacht) +
  xlab("Leeftijd (Jaren)") +
  ylab("Index nummer (nog aanpassen naar iets anders?)") +
  ggtitle("")



```

